
ch05 transactions

比特币交易

比特币交易的本质是数据结构。每笔交易都是以若干字节数据（300到400）的形式存储在区块链中。

比特币交易被创建的过程：

1.在线上或者线下产生一笔交易，资金所有者进行签名

2.这笔交易需要接入比特币网络，通过不需要加密的信道就可以发送

3.经过比特币节点确认签名，传向各个节点

4.最终被一个挖矿节点确认，并入全球总账簿



在比特币网络中交易的方式是通过UTXO（unspent transaction outputs）

UTXO具有不可分割的特性，每一笔交易中，从比特币网络中搜寻这个钱包可使用的UTXO

比特币世界中没有账户和余额，只有分散到各个区块中的UTXO

比如：一个人的账户里拥有的比特币实际上是指他拥有分散在很多个区块中的UTXO。



特殊交易类型：coinbase交易

指每个区块中的首个交易，奖励赢家矿工



交易输出：一定量的比特币和锁定脚本

Alice向Bob付款就是说Alice的钱消耗了，转化为Bob的钱，被锁在Bob的地址上。（其实是很多分散的UTXO）Bob的可以通过签名认证释放障碍去使用这些钱。

交易输入：指向特定的UTXO，解锁脚本



比特币交易脚本和脚本语言：解锁脚本和锁定脚本

利用堆栈的数据结构对输入进行运算，也就是验证签名是否正确的过程

图灵非完备性：脚本的复杂性有限，不会产生逻辑问题引起的错误比如死循环之类的。这样的逻辑炸弹可以植入交易中产生Dos攻击。



五大标准脚本    解锁脚本+锁定脚本进行运算，看最后是否返回True

1.P2PKH（Pay-To-Public-Key-Hash）

锁定脚本OP_DUP OP_HASH160 <Cafe Public Key Hash> OP_EQUAL OP_CHECKSIG  

解锁脚本<Cafe Signature> <Cafe Public Key>

（DUP复制堆栈的置顶项）

2.P2PK（Pay-To-Public-Key）satoshi

锁定脚本<Public Key A> OP_CHECKSIG  

解锁脚本<Signature from Private Key A>  

3.MS（Multiple Signature）

2-3多重签名

锁定脚本2 <Public Key A> <Public Key B> ... <Public Key C> N OP_CHECKMULTISIG  

解锁脚本OP_0 <Signature B> <Signature C>  

4.OP_Return

5.P2SH（Pay-To-Script-Hash）

引入了赎回脚本（和多重签名相对比）

赎回脚本Script 2 PubKey1 PubKey2 PubKey3 PubKey4 PubKey5 5 OP_CHECKMULTISIG

锁定脚本OP_HASH160 <20­byte hash of redeem script> OP_EQUAL

解锁脚本Sig1 Sig2 redeem script

在解锁的时候看解锁脚本和赎回脚本是否匹配

P2SH能将脚本哈希编译为一个地址20字节（基于Base58）

很多优点
